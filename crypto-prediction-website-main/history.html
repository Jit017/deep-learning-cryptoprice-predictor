<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prediction History - FutureCoin</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
  <style>
    /* Google Font */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f172a, #1e293b);
      margin: 0; padding: 0;
      color: #e5e7eb;
    }

    /* Navbar */
    .navbar {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid #334155;
      padding: 1rem 2rem;
      position: sticky;
      top: 0; z-index: 1000;
    }
    .nav-container {
      display: flex; align-items: center; justify-content: space-between;
    }
    .nav-logo { font-size: 1.3rem; font-weight: 700; color: #3b82f6; display:flex; align-items:center; gap:8px; }
    .nav-menu { list-style: none; display:flex; gap:1.5rem; margin:0; padding:0; }
    .nav-link { color:#e5e7eb; text-decoration:none; transition:0.3s; }
    .nav-link:hover, .nav-link.active { color:#3b82f6; }

    /* Container & Card */
    .container-narrow { max-width: 1100px; margin: 40px auto; padding: 0 16px; }
    .card {
      background: rgba(30, 41, 59, 0.75);
      border-radius: 16px;
      padding: 20px;
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.35);
    }

    /* Header */
    .header { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:16px; }
    .header h2 {
      font-size: 1.5rem; margin:0;
      background: linear-gradient(90deg, #3b82f6, #a855f7);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      font-weight:700;
    }

    /* Controls */
    .controls { display:flex; gap:10px; flex-wrap:wrap; }
    .input {
      padding:10px 12px; border-radius:8px;
      border:1px solid #334155;
      background: rgba(15,23,42,0.9); color:#fff;
    }
    .btn {
      padding:10px 14px; border-radius:8px;
      border:none;
      background: linear-gradient(90deg,#3b82f6,#a855f7);
      color:white; font-weight:600;
      cursor:pointer; transition:0.3s;
    }
    .btn:hover { box-shadow:0 0 12px #3b82f6; }

    /* Table */
    table { width:100%; border-collapse:collapse; margin-top:12px; border-radius:12px; overflow:hidden; }
    th, td { padding:12px 14px; text-align:left; }
    th {
      background:#1e293b;
      font-weight:600; color:#cbd5e1;
    }
    tr:nth-child(even) { background: rgba(255,255,255,0.02); }
    td { color:#e5e7eb; border-bottom:1px solid #334155; }
    .muted { color:#9ca3af; }
    .pill {
      display:inline-block; padding:4px 10px;
      border-radius:9999px; font-size:12px;
      background:rgba(59,130,246,0.2); border:1px solid #3b82f6; color:#93c5fd;
    }
    .empty { text-align:center; padding:20px; color:#9ca3af; }

    /* Footer */
    .footer {
      margin-top:40px; padding:20px;
      background: rgba(15, 23, 42, 0.95);
      text-align:center; font-size:0.9rem; color:#9ca3af;
      border-top:1px solid #334155;
    }

    /* Back to top */
    .back-to-top {
      position: fixed; right: 16px; bottom: 24px;
      border: none; border-radius: 9999px;
      padding: 12px 14px;
      background: #0f172a;
      color: #e5e7eb;
      border: 1px solid #334155;
      cursor: pointer;
      display: none; z-index: 9999;
      transition: background 0.3s ease;
    }
    .back-to-top:hover { background: #1e293b; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo"><i class="fas fa-chart-line"></i><span>FutureCoin</span></div>
      <ul class="nav-menu">
        <li><a href="index.html" class="nav-link">Home</a></li>
        <li><a href="predictions.html" class="nav-link">Predictions</a></li>
        <li><a href="compare.html" class="nav-link">Compare Models</a></li>
        <li><a href="history.html" class="nav-link active">History</a></li>
        <li><a href="about.html" class="nav-link">About</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main -->
  <main>
    <div class="container-narrow">
      <div class="card">
        <div class="header">
          <h2><i class="fas fa-clock"></i> Prediction History</h2>
          <div class="controls">
            <input id="symbol" class="input" placeholder="Filter symbol (e.g., BTC)">
            <select id="limit" class="input">
              <option value="20">Last 20</option>
              <option value="50" selected>Last 50</option>
              <option value="100">Last 100</option>
            </select>
            <button id="refresh" class="btn"><i class="fas fa-rotate"></i> Refresh</button>
          </div>
        </div>

        <div style="overflow:auto">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Symbol</th>
                <th>Horizon</th>
                <th>Daily Pred (INR)</th>
                <th>Hourly Pred (USDT)</th>
                <th>Created</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <tr><td colspan="6" class="empty">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p>&copy; 2024 FutureCoin. Built with AI and passion for crypto forecasting.</p>
  </footer>

  <!-- Back to top -->
  <button id="back-to-top" class="back-to-top" aria-label="Back to top">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- Scripts -->
  <script>
    async function fetchHistory(){
      const limit = document.getElementById('limit').value;
      const symbolFilter = document.getElementById('symbol').value.trim().toUpperCase();
      const res = await fetch(`/api/predictions/history?limit=${encodeURIComponent(limit)}`);
      if(!res.ok){
        if(res.status === 401){
          window.location.href = 'login.html?to=history.html';
          return;
        }
        document.getElementById('tbody').innerHTML = `<tr><td colspan="6" class="empty">Failed to load history</td></tr>`;
        return;
      }
      const data = await res.json();
      const items = (data.items || []).filter(x => !symbolFilter || x.symbol.toUpperCase().includes(symbolFilter));
      renderRows(items);
    }
    function renderRows(items){
      const tbody = document.getElementById('tbody');
      if(!items.length){
        tbody.innerHTML = `<tr><td colspan="6" class="empty">No predictions yet</td></tr>`;
        return;
      }
      tbody.innerHTML = items.map(it => {
        const horizon = it.days_ahead > 0 ? `${it.days_ahead}d` : (it.hours_ahead > 0 ? `${it.hours_ahead}h` : '-');
        const daily = it.daily_prediction != null ? Number(it.daily_prediction).toFixed(4) : '-';
        const hourly = it.hourly_prediction != null ? Number(it.hourly_prediction).toFixed(4) : '-';
        const when = new Date(it.created_at).toLocaleString();
        return `<tr>
          <td class="muted">#${it.id}</td>
          <td><span class="pill">${it.symbol}</span></td>
          <td>${horizon}</td>
          <td>${daily}</td>
          <td>${hourly}</td>
          <td>${when}</td>
        </tr>`;
      }).join('');
    }
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('refresh').addEventListener('click', fetchHistory);
      fetchHistory();
    });

    // Back to top
    const topBtn = document.getElementById('back-to-top');
    window.addEventListener('scroll', () => {
      topBtn.style.display = window.scrollY > 300 ? 'inline-flex' : 'none';
    });
    topBtn.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));
  </script>
</body>
</html>
