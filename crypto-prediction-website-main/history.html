<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction History - FutureCoin</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #0a1020; }
        .container-narrow { max-width: 1100px; margin: 40px auto; padding: 0 16px; }
        .card { background: #0b1220; border: 1px solid #1f2a44; border-radius: 12px; padding: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.25); }
        .header { display:flex; align-items:center; justify-content:space-between; margin-bottom: 12px; }
        .header h2 { margin: 0; }
        .controls { display:flex; gap: 10px; flex-wrap: wrap; }
        .input { padding:8px 10px; border-radius:8px; border:1px solid #23304d; background:#0d1628; color:#fff; }
        .btn { padding:8px 12px; border-radius:8px; border:1px solid #374151; background:#111827; color:#e5e7eb; cursor:pointer; }
        .btn:hover { background:#0f172a; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: left; padding: 10px; border-bottom: 1px solid #1f2a44; }
        th { color:#cbd5e1; font-weight:600; }
        td { color:#e5e7eb; }
        .muted { color:#9ca3af; }
        .pill { display:inline-block; padding:2px 8px; border-radius:9999px; font-size:12px; background:#1f2937; border:1px solid #374151; }
        .empty { text-align:center; padding: 24px; color:#9ca3af; }
    </style>
    <script>
        async function fetchHistory(){
            const limit = document.getElementById('limit').value;
            const symbolFilter = document.getElementById('symbol').value.trim().toUpperCase();
            const res = await fetch(`/api/predictions/history?limit=${encodeURIComponent(limit)}`);
            if(!res.ok){
                if(res.status === 401){
                    window.location.href = 'login.html?to=history.html';
                    return;
                }
                document.getElementById('tbody').innerHTML = `<tr><td colspan="7" class="empty">Failed to load history</td></tr>`;
                return;
            }
            const data = await res.json();
            const items = (data.items || []).filter(x => !symbolFilter || x.symbol.toUpperCase().includes(symbolFilter));
            renderRows(items);
        }
        function renderRows(items){
            const tbody = document.getElementById('tbody');
            if(!items.length){
                tbody.innerHTML = `<tr><td colspan="7" class="empty">No predictions yet</td></tr>`;
                return;
            }
            tbody.innerHTML = items.map(it => {
                const horizon = it.days_ahead > 0 ? `${it.days_ahead}d` : (it.hours_ahead > 0 ? `${it.hours_ahead}h` : '-');
                const daily = it.daily_prediction != null ? Number(it.daily_prediction).toFixed(4) : '-';
                const hourly = it.hourly_prediction != null ? Number(it.hourly_prediction).toFixed(4) : '-';
                const when = new Date(it.created_at).toLocaleString();
                return `<tr>
                    <td class="muted">#${it.id}</td>
                    <td><span class="pill">${it.symbol}</span></td>
                    <td>${horizon}</td>
                    <td>${daily}</td>
                    <td>${hourly}</td>
                    <td>${when}</td>
                </tr>`;
            }).join('');
        }
        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('refresh').addEventListener('click', fetchHistory);
            fetchHistory();
        });
    </script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-chart-line"></i>
                <span>FutureCoin</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-item"><a href="predictions.html" class="nav-link">Predictions</a></li>
                <li class="nav-item"><a href="compare.html" class="nav-link">Compare Models</a></li>
                <li class="nav-item"><a href="history.html" class="nav-link active">History</a></li>
                <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <div class="container-narrow">
            <div class="card">
                <div class="header">
                    <h2><i class="fas fa-clock"></i> Prediction History</h2>
                    <div class="controls">
                        <input id="symbol" class="input" placeholder="Filter symbol (e.g., BTC)">
                        <select id="limit" class="input">
                            <option value="20">Last 20</option>
                            <option value="50" selected>Last 50</option>
                            <option value="100">Last 100</option>
                        </select>
                        <button id="refresh" class="btn"><i class="fas fa-rotate"></i> Refresh</button>
                    </div>
                </div>
                <div style="overflow:auto">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Symbol</th>
                                <th>Horizon</th>
                                <th>Daily Pred (INR)</th>
                                <th>Hourly Pred (USDT)</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <tr><td colspan="7" class="empty">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer"><div class="container"><div class="footer-bottom"><p>&copy; 2024 FutureCoin</p></div></div></footer>

    <button id="back-to-top" class="back-to-top" aria-label="Back to top" style="position: fixed; right: 16px; bottom: 24px; display:none; border:none; border-radius:9999px; padding:12px 14px; background:#0f172a; color:#e5e7eb; border:1px solid #334155; cursor:pointer; z-index:9999;"><i class="fas fa-arrow-up"></i></button>
    <script>
        const topBtn = document.getElementById('back-to-top');
        window.addEventListener('scroll', () => {
            topBtn.style.display = window.scrollY > 300 ? 'inline-flex' : 'none';
        });
        topBtn.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));
    </script>
</body>
</html>
